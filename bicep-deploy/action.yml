name: Bicep Deploy
description: Used as the Standard Action to deploy bicep into Azure
inputs:
  main_bicep_file_path:
    description: This is the bicep file that will be deployed. it references all the Bicep Modules.
    required: true
    default: main.bicep
  bicep_parameters:
    description: Path to parameters file (leave empty if not used)
    required: false
  resourceGroupName:
    description: The name of the Resource Group that you are going to create.
    required: true
  resourceGroupLocation:
    description: What region are you deploying your application too?
    required: true
  tags_file_path:
    description: The organizational required tags (this has its own action will read the json file and create env variables)
  CLIENT_ID:
    description: this is the client id to login to azure
  AZURE_TENANT_ID:
    description: tenant
  AZURE_SUBSCRIPTION_ID:
    description: the sub id
  



# A workflow run is made up of one or more jobs that can run sequentially or in parallel
runs:
  using: composite
  # Steps represent a sequence of tasks that will be executed as part of the job
  steps:
    
    - name: Get Modules
      uses: actions/checkout@v3
      with:
        repository: jdcarroll/devops-modules
        path: modules

    - name: Prepare modules to be used by Action
      shell: bash
      run: |
        ls -ltra modules

    - name: 'Az CLI login'
      uses: azure/login@v1
      with:
          client-id: ${{ inputs.CLIENT_ID }}
          tenant-id: ${{ inputs.AZURE_TENANT_ID }}
          subscription-id: ${{ inputs.AZURE_SUBSCRIPTION_ID }}

    # - name: Deploy Azure Bicep template
    #   shell: bash
    #   run: |
    #     az deployment group create \
    #       --name ExampleDeployment \
    #       --resource-group ${{ env.AZURE_RESOURCE_GROUP }} \
    #       --template-file ./path/to/your/template.bicep \
    #       --parameters @./path/to/your/parameters.json